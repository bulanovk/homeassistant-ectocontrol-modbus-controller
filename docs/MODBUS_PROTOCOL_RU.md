# protocol_description_modbus_RS485_ectostroy_ru

_Extracted from PDF: protocol_description_modbus_RS485_ectostroy_ru.pdf_

---

~~ОГЛАВЕНИЕ~~ ~~ОГЛАВ~~ ~~**Л**~~ ~~ЕНИЕ~~


1.ОБЩАЯ ИНФОРМАЦИЯ О ПРОТОКОЛЕ ............................................................................................ 2


1.1. Для чего нужен этот документ? ...................................................................................................... 2
1.2. Физический и канальный уровень протокола ................................................................................ 2
1.3. Транспортный уровень протокола ................................................................................................. 3


2.АНАЛОГОВЫЕ ДАТЧИКИ ......................................................................................................... 5


2.1. Что такое аналоговые датчики? ...................................................................................................... 5
2.2. Структура данных аналоговых датчиков ........................................................................................ 5


3. ДИСКРЕТНЫЕ ДАТЧИКИ ......................................................................................................... 6


3.1. Что такое дискретные датчики? ...................................................................................................... 6
3.2. Структура данных дискретных датчиков ........................................................................................ 6


4. УСТРОЙСТВА УПРАВЛЕНИЯ .................................................................................................... 7


4.1. Что такое устройства управления? ................................................................................................. 7
4.2. Структуры данных устройств управления ...................................................................................... 7


5.АДАПТЕРЫ КОТЛОВ OPENTHERM/EBUS/NAVIEN ............................................................................ 9


5.1. Что такое адаптер котла? ................................................................................................................ 9
5.2. Данные регистров первой версии адаптера котла (снят с производства) ................................... 9
5.3. Данные регистров второй версии адаптера котла ...................................................................... 11


6.АДАПТЕР LORA ..................................................................................................................................... 16


6.1. Что такое адаптер LORA? ............................................................................................................... 16
6.2. Как происходит программирование и удаление датчиков? ....................................................... 16


7.АДАПТЕР LORA НОВАЯ ВЕРСИЯ ........................................................................................................ 18


7.1. Что такое адаптер LORA? ............................................................................................................... 18
7.2. Добавления адаптера LORA .......................................................................................................... 18
7.3. Удаление адаптера LORA .............................................................................................................. 18
7.3. Добавление устройств LORA ......................................................................................................... 18
7.4. Структуры блока управления адаптером LoRa ............................................................................. 19


8. БЛОК УПАРВЛЕНИЯ СМЕСИТЕЛЬНЫМИ ........................................................................................ 25


КОНТУРАМИ RS-485 (Modbus) ............................................................................................................. 25


8.1. Что умеет блок управления смесительными контурами? ........................................................... 25
8.2. Структуры блока управления смесительными контурами .......................................................... 25


9. БЛОК ИЗМЕРИТЕЛЬНЫЙ 8 КАНАЛОВ ............................................................................................. 27


9.1. Структуры блока управления измерительным блоком на 8 каналов ................................ 27


10. ПРИМЕРЫ ПАКЕТОВ ДАННЫХ ....................................................................................................... 30


1
10.02.2025


1. ОБЩАЯ ИНФОРМАЦИЯ О ПРОТОКОЛЕ


1.1. Для чего нужен этот документ ?


Настоящий документ описывает протокол обмена внешних устройств, подключаемых к

порту ДОП, с системой EctoControl. Протокол основан на основе стандарте Modbus RTU

(MODBUS APPLICATION PROTOCOL SPECIFICATION V1.1b), http://www.modbus.org.

Использование настоящего протокола позволит работать с устройствами компании

Эктострой без системы ectoControl, заменив ее на аппаратно - программные средства

пользователя .


1.2. Физический и канальный уровень протокола


На физическом уровне используется интерфейс RS-485, полудуплексный режим . В качестве

канального уровня используется протокол UART, скорость 19200 бит / с, 8 бит данных, 1

стартовый и 1 стоповый бит, без контроля четности .

Для подключения устройств к системе EctoControl или к разветвителю используется

четырехжильный кабель . Каждое устройство имеет в своем составе кабель длиной 1…10 м,

оснащенный соединителем типа 4P4C ( аналогичный устанавливаемому на кабеле трубок

проводных телефонных аппаратов ). В зависимости от производителя кабеля возможны 2

варианта соответствий цвета жилы сигналу интерфейса :







Внешний вид разъема устройств и нумерация
его контактов показана на рисунке .



По линиям +12V и GND на устройство
поступает питание (7…14 В постоянного тока ).
Линии « А » и «B» представляют собой
сигнальные линии интерфейса RS-485.
Уровень напряжения при формировании
сигнала устройством лежит в диапазоне 0…5 В,
при формировании сигнала внешним
устройством - 0…12 В .










[2 ]


1.3. Транспортный уровень протокола


Для реализации обмена данными с устройствами используются стандартные функции

протокола Modbus:

Read Holding Registers (0x03)

Write Holding Registers (0x10)

Read input registers (0x04)

Каждое устройство на шине является ведомым, для опроса устройств и управления ими

используется единое ведущее устройство ( система EctoControl).

Для чтения адреса из устройства используется функция 0x46, а для его записи в устройство

- функция 0x47 .

Далее при описании регистров используются следующие условные обозначения :

RSVD – зарезервировано для последующего использования ( чтение и запись могут

привести к непредсказуемому результату )

R – доступ только на чтение (input registers). Запись не даст результата .

RW – доступ на чтение и запись (holding registers)

Каждое устройство содержит однотипную информационную структуру, содержащую общую

информацию об устройстве .

Начальный адрес структуры ( регистры ): 0x0000, holding registers

Длина структуры ( регистры ): 4

|Адрес байта|0|1|2|3|4|5|6|7|
|---|---|---|---|---|---|---|---|---|
|Поле|RSVD|UID|UID|UID|RSVD|ADDR|TYPE|CHN_CN<br>T|
|Регистр|0|0|1|1|2|3|3|3|
|Доступ|R|R|R|R|R|R|R|R|
|Адрес <br>регистра|0x0000|0x0000|0x0001|0x0001|0x0002|0x0003|0x0003|0x0003|



UID - уникальный идентификатор устройства ( длина 3 байта ), диапазон значений :

[0x800000; 0xFFFFFF].
ADDR - логический адрес устройства на шине ModBus, по умолчанию 0xF0 ( _может_ _быть_
_принудительно_ _записан_ _мастером_ _с_ _помощью_ _широковещательного_ _пакета_ ). Имеет
диапазон 0x01…0x20.
TYPE - тип устройства, определяющий его физические свойства :
Измерительные датчики :
0x22 – датчик температуры
0x23 – датчик влажности воздуха
Контактные датчики :
0x50 – универсальный контактный датчик


3
10.02.2025


0x59 – разветвитель контактного датчика 10- канальный
Устройства управления :
0xC0 – блок управления реле двухканальный
0xC1 – блок управления реле десятиканальный
Прочие устройства :
0x11 – адаптер OpenTherm ( первая версия, снята с производства )
0x14 – адаптер OpenTherm ( вторая версия )
0x15 – адаптер eBus
0x16 – адаптер Navien
CHN_CNT - число каналов устройства (1…10).

Производитель устройств не задает им при производстве какой - либо конкретный адрес,
перед обменом данными нужно принудительно задать этот адрес или прочитать
имеющийся в устройстве адрес .

Для задания устройству уникального адреса на шине Modbus используется процедура
программирования адреса . Процедура основана на отправке специальной функции
PROG_READ (0x46) и PROG_WRITE (0x47).

Функция PROG_READ (0x46) ( высылается ведущим устройством единственному устройству
на шине с неизвестным адресом ).

Запрос от ведущего устройства :

|Широковещательный адрес|Код функции|CRC_HI|CRC_LO|
|---|---|---|---|
|0x00|0x46|0xXX|0xXX|



Ответ от ведомого устройства :

|Адрес ведомого<br>устройства|Код функции|Адрес устройства|CRC_HI|CRC_LO|
|---|---|---|---|---|
|0x00|0x46|ADDR|0xXX|0xXX|



Устройство возвращает в ответе свой текущий адрес ADDR.

Функция PROG_WRITE (0x47) ( высылается ведущим устройством ведомому с указанием
сменить свой имеющийся адрес на заданный ).

Запрос от ведущего устройства :

|Широковещательный адрес|Код функции|Новый адрес|CRC_HI|CRC_LO|
|---|---|---|---|---|
|0x00|0x47|ADDR|0xXX|0xXX|



Ответ от ведомого устройства :

|SLAVE_ADDR|Код функции|Новый адрес|CRC_HI|CRC_LO|
|---|---|---|---|---|
|ADDR|0x47|ADDR|0xXX|0xXX|



Устройство обновляет свой адрес на ADDR и высылает ответ уже с нового адреса .


[4 ]


**2.АНАЛОГОВЫЕ ДАТЧИКИ**


2.1. Что такое аналоговые датчики ?


Аналоговые датчики измеряют непрерывные физические величины : температуру,
влажность и т . д . Показания такого датчика выражаются широким набором значений .

Каждое устройство может иметь в своем составе до 10 независимых измерительных
каналов .


2.2. Структура данных аналоговых датчиков


Начальный адрес структуры ( регистры ): 0x0020, input registers
Длина структуры ( регистры ): CHN_CNT (1…10)

|Байт|0:MSB|1:LSB|2:MSB|3:LSB|...|CHN_CNT-2:MSB|CHN_CNT-1:LSB|
|---|---|---|---|---|---|---|---|
|Поле|CHN 0|CHN 0|CHN 1|CHN 1|...|CHN 9|CHN 9|
|Регистр|0|0|1|1|...|CHN_CNT-1|CHN_CNT-1|
|Доступ|R|R|R|R|R|R|R|
|Адрес|0x0020|0x0020|0x0021|0x0021|...|0x0020+CHN_CNT-1|0x0020+CHN_CNT-1|



CHN0…CHN9 - данные датчика для каналов 1…10. Данные действительны только для того
количества доступных каналов, которое указано в поле CHN_CNT информационной
структуры .
CHN _N_ - данные измерения . Для датчиков температуры (TYPE=0x22) представляет собой
знаковое целое шестнадцатиразрядное число, MSB – старший байт, LSB – младший байт .
Диапазон возможных значений : -32768…+32767. Показания температуры указываются как
число -400…+990, что соответствует -40…+99 град . С в десятых долях градуса . Например,
значение 0x123 будет соответствовать 29,1 С ( в десятичной системе 0x123 = 291, т . е .
29,1 С ). Для датчика влажности воздуха (TYPE=0x23) возможные значения будут в диапазоне
0…1000, что отражает показание относительной влажности в десятых долях процента .
Например, данные 0x381 будут соответствовать 89,7% (0x381 = 897, т . е . 89,7%).


5
10.02.2025


**3. ДИСКРЕТНЫЕ ДАТЧИКИ**


3.1. Что такое дискретные датчики ?


Дискретные датчики отображают только два состояния, например, замкнута цепь или
разомкнута, норма или тревога, есть напряжение или нет и т . д .

Каждое устройство может иметь в своем составе до 10 независимых дискретных каналов .


3.2. Структура данных дискретных датчиков


Начальный адрес структуры ( регистры ): 0x0010, input registers

Длина структуры : 1 или 2 регистра .

|Байт|0:MSB|1:LSB|2:MSB|3:LSB|
|---|---|---|---|---|
|Поле|CHN 0…7|CHN 0…7|CHN 8…10|CHN 8…10|
|Регистр|0|0|1|1|
|Доступ|R|R|R|R|
|Адрес|0x0010|0x0010|0x0011|0x0011|



Номер регистра соответствует целочисленному делению номера канала на 16:
REG_NO = CHN_NO/16

Номер байта соответствует целочисленному делению номера канала на 8:
BYTE_NO = CHN_NO/8

Номер бита в каждом байте соответствует номеру канала по остатку от деления на 8:
BIT_NO = CHN_NO%8


[6 ]


**4. УСТРОЙСТВА УПРАВЛЕНИЯ**


4.1. Что такое устройства управления ?


Устройства управления позволяют включить или отключить потребители электрического
тока, открыть или закрыть кран . Таким устройствам можно дать команду на перевод их в
одно из двух состояний : ВКЛ или ОТКЛ для реле, ОТКР или ЗАКР для привода крана . Также
доступно чтение состояния этих устройств, чтобы проверить, верно ли выполнена
команда .

Так же имеется возможность перевести устройства в состояние на заданное время, по
истечению которого устройство автоматически, без дополнительной команды вернется
первоначальное состояние .

Устройства такого рода имеют 2 типа структур : битовые маски каналов ( для управления и
чтения состояния ) и массив таймеров ( для задания времени удержания устройства в
заданном состоянии ).


4.2. Структуры данных устройств управления


Начальный адрес структуры состояния каналов и управления ими ( регистры ): 0x0010,
holding registers

Длина структуры : 1

|Байт|0:MSB|1:LSB|
|---|---|---|
|Поле|CHN 0-7|CHN 8-10|
|Регистр|0|0|
|Доступ|RW|RW|
|Адрес|0x0010|0x0010|



Номер регистра соответствует целочисленному делению номера канала на 16:
REG_NO = CHN_NO/16

Номер байта соответствует целочисленному делению номера канала на 8:
BYTE_NO = CHN_NO/8

Номер бита в каждом байте соответствует номеру канала по остатку от деления на 8:
BIT_NO = CHN_NO%8

Установленный бит означает включенное устройство, сброшенный - отключенное .


7
10.02.2025


Начальный адрес структуры таймеров : ( регистры ): 0x0020, holding registers.
Длина структуры ( регистры ): CHN_CNT.

|Байт|0:MSB|1:LSB|2:MSB|3:LSB|...|CHN_CNT-2:MSB|CHN_CNT-1:LSB|
|---|---|---|---|---|---|---|---|
|Поле|CHN 0|CHN 0|CHN 1|CHN 1|...|CHN 9|CHN 9|
|Регистр|0|0|1|1|...|CHN_CNT-1|CHN_CNT-1|
|Доступ|RW|RW|RW|RW|RW|RW|RW|
|Адрес|0x0020|0x0020|0x0021|0x0021|...|0x0020+CHN_CNT-1|0x0020+CHN_CNT-1|



CHN _n_ - данные времени, в течение которого должно удерживаться заданное состояние
устройства ( биты 14…0) и начальное состояние устройства ( бит 15). Состояние реле
применяется только в пакете записи в регистры таймеров, после получения устройством
команды значение старшего бита мгновенно применяется к соответствующему выходу и
удаляется из регистра, остаток соответствует таймауту, по истечении которого состояние
реле будет изменено на противоположное .

Нормальное состояние таймера равно нулю, ( таймер считает сверху вниз ). Состояние,
отличное от нуля, свидетельствует о том, что таймер запущен . Когда значение таймера
достигает нуля, выход соответствующего канала инвертируется . Значение
соответствующего регистра определяет задержку кратно 500 мс . Например, для задержки в
5 секунд необходимо передать значение регистра 0x000A (10 dec). Таким образом в
диапазоне 0x0001-0x7FFF возможно формирование интервалов времени от 500 мс до
16383.5 с (4 часа, 33 мин ., 3.5 с ).


[8 ]


5. АДАПТЕРЫ КОТЛОВ OPENTHERM/EBUS/NAVIEN


5.1. Что такое адаптер котла ?


Адаптер котла позволяет управлять котлом с использованием его цифрового интерфейса
передачи данных . Способ взаимодействия с адаптером по шине Modbus одинаков для
любого типа адаптера .

Для доступа к регистрам адаптеров используются функции :

Read Holding Registers (0x03) для чтения регистров,

Write Holding Registers (0x10) для записи в регистры .

Существует 2 аппаратной версии адаптера .

Первая версия ( снята с производства ) отличалась синей печатной платой и выпускалась
только для котлов с интерфейсами OpenTherm и eBus. Особенность этой версии - наличие
встроенных алгоритмов регулирования температуры, поэтому среди настроек
присутствовал выбор режима работы котла, выбор гистерезиса и т . д . Первая версия снята
с производства .

Вторая версия отличается желтой печатной платой, все функции и алгоритмы
регулирования переложены на систему ectoControl.

Обе версии адаптеров используют различное назначение регистров ( за исключением
единого для всех заголовка, находящегося в регистрах 0x0000…0x0003 и единой функции
чтения и установки адресов ).

Адаптер опрашивает все параметры котла постепенно, один за другим, поэтому сразу после
включения питания адаптера регистры, содержащие параметры котла ( температуру,
давление, расход ) могут содержать значения, указывающие на то, что данные еще не
прочитаны : 0x7FFF ( для двухбайтных значений ), 0x7F или 0xFF ( для однобайтных значений ).
Также такие показания могут считываться для параметров, которые не поддерживаются
электроникой котла .


5.2. Данные регистров первой версии адаптера котла ( снят с производства )






|Col1|Регистры для записи|Col3|Col4|Col5|Col6|
|---|---|---|---|---|---|
|Байт|Поле|Регистр|Доступ|Адрес <br>регистра|<br>|
|0|Биты управления режимами котла: <br>bit 0:Первый контур отопления  (1-вкл, 0-откл) <br>bit 1:Контур ГВС  (1-вкл, 0-откл)<br>bit 2:Второй контур отопления  (1-вкл, 0-откл) <br>bit 3:Режим регулирования температуры (1-ПЗА,0 -<br>Tермостат) <br>bit 4:Сброс блокировки котла, возникшей в результате <br>ошибки его работы. (1 –выполнить сброс, 0 –нет <br>действия).<br>bit 5:Релейный режим (горелка на максимуме) (1-вкл, 0-<br>откл)<br> bit 6:Режим ПЗА с двумя термодатчиками (1-вкл, 0-<br>откл)<br>bit 7:Перезагрузка адаптера (1-выполнить <br>перезагрузку, 0-нет действия)|0|W|0x0010||
|1|Максимальный уровень модуляции горелки (0…100%)|Максимальный уровень модуляции горелки (0…100%)|Максимальный уровень модуляции горелки (0…100%)|Максимальный уровень модуляции горелки (0…100%)||



9
10.02.2025


|2|Уставка температуры ГВС (0…80C, шаг 1С)|1|W|0x0011|Col6|
|---|---|---|---|---|---|
|3|3|3|3|3||
|4|Номер кривой ПЗА для режима ПЗА (0…15)|2|W|0x0012||
|5|Гистерезис для релейного режима (в десятых долях С, 1…50,<br>что соответствует 0,1…5С)|Гистерезис для релейного режима (в десятых долях С, 1…50,<br>что соответствует 0,1…5С)|Гистерезис для релейного режима (в десятых долях С, 1…50,<br>что соответствует 0,1…5С)|Гистерезис для релейного режима (в десятых долях С, 1…50,<br>что соответствует 0,1…5С)||
|6|Запись: требуемая температуры воздуха в помещении (0…80C,<br>шаг 1С).<br>Чтение: Текущее значение температуры контура отопления, <br>отправленное адаптером котлу (0…80C,шаг 0,1град. С)|3|RW|0x0013||
|7|7|7|7|7||
|8|Уставка максимальной температуры первого контура (0…80C,<br>шаг 1С)|4|W|0x0014||
|9|9|9|9|9||
|10|Уставка минимальной температуры первого контура (0…80C,<br>шаг 1С)|5|W|0x0015||
|11|11|11|11|11||
|12|Уставка максимальной температуры ГВС (0…80C,шаг 1С)|6|W|0x0016||
|13|13|13|13|13||
|14|Уставка минимальной температуры ГВС (0…80C,шаг 1С)|7|W|0x0017||
|15|15|15|15|15||
|16|Уставка температуры контура отопления для аварийного <br>режима (недоступны термодатчики) (0…80C,шаг 1С).<br>Используется для случая, когда термодатчики воздуха <br>отсутствуют и котлу необходимо ориентироваться на <br>собственный встроенный датчик температуры на подающем <br>трубопроводе.|8|W|0x0018||
|17|17|17|17|17||
|18|Температура воздуха в отпливаемом помещении (в десятых <br>долях С, значения -400…+1000,что соответствует -<br>40,0…+100,0С)|9|W|0x0019||
|19|19|19|19|19||
|20|Температура воздуха окружающей среды для режима ПЗА (в <br>десятых долях С, значения -400…+1000,что соответствует -<br>40,0…+100,0С)|10|W|0x001A||
|21|21|21|21|21||









|Col1|Регистры для чтения|Col3|Col4|Col5|
|---|---|---|---|---|
|Байт|Поле|Регистр|RW<br>access|Адрес <br>регистра|
|0|Уникальный код производителя котла|0|R|0x0020|
|1|1|1|1|1|
|2|bit 0:Состояние горелки (1-вкл, 0 -откл) <br>bit 1:Первый контур отопления (1-вкл, 0 -откл) <br>bit 2:ГВС (1-вкл, 0 -откл) <br>bit 3:Второй контур отопления (1-вкл, 0 -откл) <br>bit 4:Наличие ошибок котла (1-есть, 0 -нет) <br>bit 5:Связь между котлом и адаптером (1–есть, 0<br>нет).|1|R|0x0021|
|3|Текущее значение модуляции горелки (0…100%).Если котел <br>не поддерживает этот параметр, значение равно 0xFF.|Текущее значение модуляции горелки (0…100%).Если котел <br>не поддерживает этот параметр, значение равно 0xFF.|Текущее значение модуляции горелки (0…100%).Если котел <br>не поддерживает этот параметр, значение равно 0xFF.|Текущее значение модуляции горелки (0…100%).Если котел <br>не поддерживает этот параметр, значение равно 0xFF.|
|4|Температура первого контура отопления (0…80C,шаг 0,1С).<br>Если котел не поддерживает этот параметр, значение равно <br>0x7FFF.|2|R|0x0022|
|5|5|5|5|5|
|6|Температура ГВС (0…80C,шаг 0,1С).Если котел не <br>поддерживает этот параметр, значение равно 0x7FFF.<br>|3|R|0x0023|
|7|7|7|7|7|
|8|Расход ГВС (л/мин или дл/мин, зависит от модели котла, в <br>десятых долях единицы измерения).Если котел не|4|R|0x0024|



[10 ]




|Col1|поддерживает этот параметр, прочитанное значение равно<br>0xFF.|Col3|Col4|Col5|
|---|---|---|---|---|
|9|Давление в контуре отопления (0…5бар, шаг 0,1бар)|Давление в контуре отопления (0…5бар, шаг 0,1бар)|Давление в контуре отопления (0…5бар, шаг 0,1бар)|Давление в контуре отопления (0…5бар, шаг 0,1бар)|
|10|Код ошибки, характерный для всех котлов. <br>0:Необходимо обслуживание <br>1:Котел заблокирован <br>2:Низкое давление в отопительном контуре <br>3:Ошибка розжига <br>4:Низкое давление воздуха <br>5:Перегрев теплоносителя в контуре|5|R|0x0025|
|11|Код ошибки, характерный для данной модели котла.|Код ошибки, характерный для данной модели котла.|Код ошибки, характерный для данной модели котла.|Код ошибки, характерный для данной модели котла.|
|12|Код самодиагностики котла. Характере для конкретной <br>модели и конкретного производителя.|6|R|0x0026|
|13|13|13|13|13|
|14|Текущая уставка температуры контура отопления (0…80C,шаг <br>1/256град. С)|7|R|0x0027|
|15|15|15|15|15|


5.3. Данные регистров второй версии адаптера котла


Регистры для чтения











|Адрес<br>регистра|тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0010|R|_bitfields_ <br>бит 2...0 -тип <br>адаптера.<br>000 - Opentherm<br>001 - eBus<br>010 - Navien<br>бит 3 -состояние <br>связи с котлом <br>0 -нет ответа от <br>котла на <br>последнюю команду <br>1 -есть ответ от <br>котла на <br>последнюю команду|_u8_ <br>Код последней перезагрузки адаптера. <br> <br>0...255 -код|
|0x0011|R|_u8_ <br>Аппаратная версия <br>адаптера. <br>0...255 -номер <br>версии|_u8_ <br>Программная версия адаптера. <br>0...255 -номер версии|
|0x0012|R <br>|_u32_ <br>Время работы адаптера после перезагрузки <br>0...4294967295 -время в секундах|_u32_ <br>Время работы адаптера после перезагрузки <br>0...4294967295 -время в секундах|
|0x0013|0x0013|0x0013|0x0013|
|0x0014|R||u8<br>Нижний предел уставки теплоносителя. <br>0...100 -температура уставки в град. С|
|0x0015|R||u8<br>Верхний предел уставки теплоносителя <br>0...100 -температура уставки в град. С|


11
10.02.2025


|0x0016|R|Col3|u8<br>Нижний предел уставки ГВС<br>0...100 - температура уставки в град. С|
|---|---|---|---|
|0x0017|R||u8<br>Верхний предел уставки ГВС <br>0...100 -температура уставки в град. С|
|0x0018|R|i16<br>Текущая температура теплоносителя <br>-100...100 -температура в 0.1гр. С|i16<br>Текущая температура теплоносителя <br>-100...100 -температура в 0.1гр. С|
|0x0019|R|<br>u16<br>Текущая температура ГВС <br>0...100 -температура в 0.1гр. С|<br>u16<br>Текущая температура ГВС <br>0...100 -температура в 0.1гр. С|
|0x001A|R||u8<br>Текущее Давление в контуре <br>0...50 -давление в (0,1бар)|
|0x001B|R||Текущий расход ГВС <br>1...255 -расход в (0,1л/мин)|
|0x001C|R||Текущая модуляция горелки <br>0xFF -не определено <br>0...100 -модуляция в (%)|
|0x001D|R||_bitfields_ <br>бит 0 -текущее состояние горелки <br>0 -отключена <br>1 -включена <br>бит 1 -текущее состояние отопления <br>0 -отключено <br>1 -включено <br>бит 2 -текущее состояние ГВС <br>0 -отключено <br>1 -включено <br>|
|0x001E|R|u16<br>Код ошибки котла (основной).Зависит от марки и модели котла. <br>0...65535 -код ошибки <br>|u16<br>Код ошибки котла (основной).Зависит от марки и модели котла. <br>0...65535 -код ошибки <br>|
|0x001F|R|u16<br>Код ошибки котла (дополнительный).Зависит от марки и модели котла. <br>0...65535 -код ошибки|u16<br>Код ошибки котла (дополнительный).Зависит от марки и модели котла. <br>0...65535 -код ошибки|
|0x0020|R||s8<br>Температура уличного датчика котла (при его <br>наличии).В зависимости от марки и модели <br>котла может не поддерживаться. <br>-65…+100температура в градусах С|
|0x0021|R|u16<br>Код производителя котла. Зависит от марки и модели котла. <br>0...65535 -код производителя|u16<br>Код производителя котла. Зависит от марки и модели котла. <br>0...65535 -код производителя|
|0x0022|R|u16<br>Код модели котла. Зависит от марки и модели котла. <br>0...65535 -код модели|u16<br>Код модели котла. Зависит от марки и модели котла. <br>0...65535 -код модели|
|0x0023|R||s8<br>Флаги ошибок (только для котлов с интерфейсом <br>OpenTherm)|



[12 ]


Регистры для записи :

|Адрес<br>регистра|тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0030|W||_u8_ <br>Тип внешних подключений (будет сохранено в постоянной памяти <br>адаптера) <br>0 -адаптер подключен к котлу <br>1 -котел подключен к внешнему устройству (панель или <br>перемычка)|
|0x0031|W|int16<br>Уставка теплоносителя (будет сохранено в постоянной памяти адаптера).<br>Будет передана котлу при старте адаптера, пока главным устройством не <br>были записаны регистры уставки температуры. <br>0...1000 -температура уставки в десятых долях градуса С (например, для <br>установки 45С нужно записать число 450).Во многих котлах необходимо до <br>подключения адаптера необходимо поднять температуру теплоносителя <br>отопления (нажимая “+”на панели котла) для согласования диапазона <br>температуры теплоносителя, в противном случае температура теплоносителя <br>может не достигнуть требуемого значения.|int16<br>Уставка теплоносителя (будет сохранено в постоянной памяти адаптера).<br>Будет передана котлу при старте адаптера, пока главным устройством не <br>были записаны регистры уставки температуры. <br>0...1000 -температура уставки в десятых долях градуса С (например, для <br>установки 45С нужно записать число 450).Во многих котлах необходимо до <br>подключения адаптера необходимо поднять температуру теплоносителя <br>отопления (нажимая “+”на панели котла) для согласования диапазона <br>температуры теплоносителя, в противном случае температура теплоносителя <br>может не достигнуть требуемого значения.|
|0x0032|W|int16<br>Уставка теплоносителя в аварийном режиме(будет сохранено в <br>постоянной памяти адаптера).Будет передана котлу в случае <br>отсутствия связи с главным управляющим устройством. <br>0...1000 -температура уставки в десятых долях град. С (например, <br>для установки 45С нужно записать число 450)|int16<br>Уставка теплоносителя в аварийном режиме(будет сохранено в <br>постоянной памяти адаптера).Будет передана котлу в случае <br>отсутствия связи с главным управляющим устройством. <br>0...1000 -температура уставки в десятых долях град. С (например, <br>для установки 45С нужно записать число 450)|
|0x0033|W||u8<br>Нижний предел уставки теплоносителя <br>0...100 -температура уставки в град. С <br> <br>Не все котлы поддерживают этот параметр. Как правило, этот <br>предел не должен быть ниже аналогичного предела, <br>установленного в настройках котла.|
|0x0034|W||u8<br>Верхний предел уставки теплоносителя <br>0...100 -температура уставки в град. С <br> <br>Не все котлы поддерживают этот параметр. Как правило, этот <br>предел не должен быть выше аналогичного предела, <br>установленного в настройках котла. <br>|
|0x0035|W||u8<br>Нижний предел уставки ГВС <br>0...100 -температура уставки в град. С <br> <br>Не все котлы поддерживают этот параметр. Как правило, этот <br>предел не должен быть ниже аналогичного предела, <br>установленного в настройках котла.|
|0x0036|W||u8<br>Верхний предел уставки ГВС <br>0...100 -температура уставки в град. С|



13
10.02.2025


|Col1|Col2|Col3|Не все котлы поддерживают этот параметр. Как правило, этот<br>предел не должен быть выше аналогичного предела,<br>установленного в настройках котла.|
|---|---|---|---|
|0x0037|W||u8<br>Уставка ГВС (EPROM)<br>0...100 -температура уставки в град. С <br> <br>Для большинства котлов эта уставка должна находиться ниже <br>предела, установленного в меню самого котла, иначе она может быть <br>проигнорирована котлом. Для некоторых котлов стоит устанавливать <br>этот параметр равным верхнему пределу уставки ГВС.|
|0x0038|W||u8<br>Уставка максимальной модуляции горелки (будет сохранено в <br>постоянной памяти адаптера) <br>0...100 -уровень модуляции в процентах. <br>Данный параметр поддерживается не всеми котлами.Для <br>электрических трехфазных котлов возможно задать только 3<br>уровня модуляции (в диапазоне 0…100%).|
|0x0039|W||_bitfields_ <br>бит 0 -режим контура отопления (будет сохранено в постоянной <br>памяти адаптера) <br>0 -отключен <br>1 -включен <br>бит 1 -режим контура ГВС <br>0 -отключен <br>1 -включен <br>бит 2 - “второй контур”,используется только некоторыми котлами с <br>интерфейсом OpenThermи может отвечать за активацию бойлера <br>косвенного нагрева или встроенной функции ГВС. <br>0 -отключен <br>1 -включен|


Регистры состояния :

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0040…<br>0x006F|R|i16<br>состояние данных в регистре ($addr - 0x30)<br>-2 -ошибка чтения/записи в котел <br>-1 -регистр не поддерживается <br>0-для регистра на чтение означает, что данные из котла прочитаны и <br>валидны. Для регистра на запись означает, что данные успешно приняты <br>котлом. <br>1-не инициализирован.<br>если регистр R:чтение соответствующих данные из котла не <br>приводилось,<br>если регистр W:адаптеру не было задано значение для записи <br>соответствующего значения в котле <br>|i16<br>состояние данных в регистре ($addr - 0x30)<br>-2 -ошибка чтения/записи в котел <br>-1 -регистр не поддерживается <br>0-для регистра на чтение означает, что данные из котла прочитаны и <br>валидны. Для регистра на запись означает, что данные успешно приняты <br>котлом. <br>1-не инициализирован.<br>если регистр R:чтение соответствующих данные из котла не <br>приводилось,<br>если регистр W:адаптеру не было задано значение для записи <br>соответствующего значения в котле <br>|



Регистр команд :


[14 ]


|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0080|W|uint16<br>команда <br>0 -нет команды <br>1 - CH water filling (зарезервировано) <br>2 -перезагрузка адаптера <br>3 -сброс ошибок котла <br>4..65525 -зарезервировано <br> <br>При записи любой команды, кроме «нет команды»,сразу же меняется <br>состояние регистра «Ответ на команду» -становится 2 –идет <br>обработка команжы|uint16<br>команда <br>0 -нет команды <br>1 - CH water filling (зарезервировано) <br>2 -перезагрузка адаптера <br>3 -сброс ошибок котла <br>4..65525 -зарезервировано <br> <br>При записи любой команды, кроме «нет команды»,сразу же меняется <br>состояние регистра «Ответ на команду» -становится 2 –идет <br>обработка команжы|
|0x0081|R|int16<br>Ответ на команду <br>-32768..-6 -зарезервировано <br>-5 –ошибка выполнения команды <br>-4 –неподдерживаемая котлом команда <br>-3 –не поддерживаемый котлом идентификатор устройства <br>-2 –не поддерживается данный адаптером <br>-1 –не получен ответ за отведенное врекмя <br>0 –команда выполнена успешно <br>1 –не было команды (значение по умолчанию) <br>2 –идет обработка команды (обмен данными) <br>3..32767 -зарезервировано <br> <br>Если команда после перезагрузки адаптера не давалась, регистр <br>читается как 1 -не было команды.|int16<br>Ответ на команду <br>-32768..-6 -зарезервировано <br>-5 –ошибка выполнения команды <br>-4 –неподдерживаемая котлом команда <br>-3 –не поддерживаемый котлом идентификатор устройства <br>-2 –не поддерживается данный адаптером <br>-1 –не получен ответ за отведенное врекмя <br>0 –команда выполнена успешно <br>1 –не было команды (значение по умолчанию) <br>2 –идет обработка команды (обмен данными) <br>3..32767 -зарезервировано <br> <br>Если команда после перезагрузки адаптера не давалась, регистр <br>читается как 1 -не было команды.|


15
10.02.2025


6. АДАПТЕР LORA


6.1. Что такое адаптер LORA?


LoRa – дополнительная радиосеть системы ectoControl, отличающаяся более дальним
радиусом действия .

Адаптер LoRa хранит в себе все данные подключенных радиодатчиков и позволяет
системе EctoControl увидеть эти датчики как обычные проводные датчики интерфейса
ДОП (RS-485). Таким образом система может видеть до 32 датчика собственной радиосети
и еще 32 датчика порта ДОП ( под видом которых работают радиодатчики LoRa). Поэтому
система видит радиодатчики LoRa только как проводные с портом ДОП и это нисколько не
отражается на программах и оповещениях системы .


6.2. Как происходит программирование и удаление датчиков ?


Программирование датчиков выполняется по одному . Происходит это так :

1. Система отправляет широковещательный пакет с функцией PROG_READ (0x46),
ожидая получить данные датчика на шине . Адаптер LoRa использует этот пакет для
активации поиска радиодатчиков и не отвечает системе .

2. Адаптер LoRa ожидает программирования одного радиодатчика в течение 60 с . Если
датчик был запрограммирован, адаптер запоминает его данные и ждет повторного
запроса от системы .

3. Система повторно отправляет широковещательный пакет с функцией PROG_READ
(0x46), при этом адаптер, храня данные ранее запрограммированного радиодатчика,
ответит функцией PROG_READ (0x46) с адреса 0x7F ( с этого адреса будут отвечать
только вновь добавленные датчики ). Если новые радиодатчики не были
запрограммированы, адаптер не ответит системе .

4. Если адаптер ответил данными нового датчика, система обязана сменить адрес
датчику, так как он изначально лежит вне допустимого диапазона (0x00...0x1F). Для
этого она отправляет адаптеру пакет с функцией PROG_WRITE (0x47) на адрес 0x7F c
указанием нового адреса датчика в диапазоне 0x00...0x1F. Новый адрес выбирается
исходя из уже имеющихся в памяти системы датчиков . Адаптер подтверждает, что
новый датчик заменил свой адрес на заданный пакетом с функцией PROG_WRITE
(0x47), высланным с нового адреса .

5. Система обязана запомнить данные датчика с новым адресом и периодически
опрашивать его, равно как и опрашивать ранее запрограммированные датчики
функцией Read input registers (0x03) .

6. Если нужно запрограммировать более одного радиодатчика, п .1 надо повторить
столько раз, сколько датчиков необходимо добавить ( до 32 шт ).

Удаление радиодатчика LoRa из адаптера происходит следующим образом .

Адаптер хранит в себе данные радиодатчиков, и, если в него запрограммированы все 32
датчика и каждый из них периодически опрашивается системой, запрограммировать в
адаптер новый датчик будет невозможно . Однако система может перестать опрашивать
один или несколько датчиков, и, если адаптер не увидит запроса данных какого - либо


[16 ]


датчика за период более 150 с, он будет считать, что система удалила у себя этот датчик и
позволит запрограммировать на его место новый .

Как происходит эмуляция проводных датчиков адаптером LoRa?

1. Если радиодатчик LoRa не на связи, адаптер перестает отвечать на запросы от
системы по адресу « пропавшего » датчика через 150 с после его ухода со связи .
Отсутствующий ответ на запрос система интерпретирует как признак « нет связи »
с указанным датчиком .
2. Датчик температуры LoRa при неисправности сенсора и при первом включении
может в качестве значения температуры прислать код 0x7E7E. Система может
интерпретировать это значение как отсутствие связи с датчиком или его
частичное повреждение .


17
10.02.2025


7. АДАПТЕР LORA НОВАЯ ВЕРСИЯ


7.1. Что такое адаптер LORA?


LoRa – дополнительная радиосеть системы ectoControl, отличающаяся более дальним
радиусом действия .

Адаптер LoRa новая версия воспринимается системой ectoControl самостоятельным
устройством ( многоканальный датчик ) и расширяет функционал устройств сети LoRa. В
систему можно добавить до 32- ух адаптеров LoRa и до 32- ух устройств LoRa. Устройства
тиражируются во все адаптеры .


7.2. Добавления адаптера LORA


Добавление адаптера производится путем ввода или сканирования серийного номера,
или через кнопку УСТ .


7.3. Удаление адаптера LORA


При удалении адаптера, система производит следующие действия :

 - снимает с адаптера роль ведущего и переносит устройства из его зоны
ответственности на другие адаптеры ( при этом если этот адаптеры был вручную
выбран ведущим, опция принимает значение “ Автоматический выбор ”)

 - перестает опрашивать адаптер


7.3. Добавление устройств LORA


Добавление традиционным методом .

Режим добавления активируется командой из ЛК, при этом необходимо выбрать адаптер
который физически находится ближе остальных к добавляемым устройствам, система
выполняет следующие шаги :

 - отключает режим добавления устройств на всех адаптерах кроме выбранного

 - активирует режим добавления устройств на указанном адаптере

 - пока активен режим система регулярно опрашивает таблицу устройств адаптера

 - по выходу таймаута работы режима ( или при получении новой команды ), система
отключает режим на адаптере
При появлении новых устройств на адаптере с активным режимом добавления
устройств, система производит следующие шаги :

 - адаптер назначается ведущим для добавляемого устройства

 - производится попытка создать новое устройство, если это невозможно ( тип
устройства не известен или нет свободных ячеек для многоканальных устройств ) система отображает предупреждение в терминале и удаляет устройство из памяти
адаптера


[18 ]


 - после успешного создания устройства LoRa активируется процесс синхронизации
таблиц во всех прочих адаптерах LoRa ( аналогично тому как это производится при
старте системы или добавлении нового адаптера LoRa)

Добавление по серийному номеру

При добавлении устройства путем ввода или сканирования серийного номера,
независимо от способа передачи серийного номера в систему, она производит
следующие действия :

 - производится попытка создать новое устройство, если это невозможно ( тип
устройства не известен или нет свободных ячеек для многоканальных устройств ) система отображает предупреждение в терминале и возвращает ответ с кодом
ошибки если это предполагается алгоритмами передачи команды

 - после успешного создания устройства LoRa активируется процесс синхронизации
таблиц во всех прочих адаптерах LoRa ( аналогично тому как это производится при
старте системы или добавлении нового адаптера LoRa)

 - запускается алгоритм автоматического выбора ведущего адаптера


7.4. Структуры блока управления адаптером LoRa


Для доступа к регистрам адаптеров используются функции :

Read Holding Registers (0x03) для чтения регистров,

Read Input Registers (0x04) для чтения регистров

Write Holding Registers (0x10) для записи в регистры .

Read Device Address Serial Number (0x4b) для чтения адреса устройства по его серийному

номеру

Write Device Address Serial Number (0x4 с ) для записи адреса устройства по его серийному

номеру

7.4.1 Чтение адреса устройства по его серийному номеру (Read Device Address Serial

Number):


Запрос от мастера :

|00h|4Bh|00h|00h|00h|00h|00h|00h|00h|00h|00h|00h|4Fh|4Ah|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|CRC<br>старш.|CRC<br>младш.|



Ответ от устройства :

|00h|4Bh|01h|86h|F0h|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



7.4.2 Запись адреса устройства по его серийному номеру (Write Device Address Serial

Number):


19
10.02.2025


Запрос от мастера :

|00h|4Ch|00h|00h|00h|00h|00h|00h|00h|00h|00h|00h|01h|CCh|F3h|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Уникальный 12-байтный серийный номер устройства|Адрес <br>устр-ва|CRC<br>старш.|CRC<br>младш.|



Ответ от устройства :

|00h|4Ch|01h|84h|C0h|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



7.4.3 Регистры информация об устройстве (Holding Registers):



|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0000<br>0x0005|R|12x u8<br>Уникальный 12-байтный серийный номер устройства|12x u8<br>Уникальный 12-байтный серийный номер устройства|
|0x0006|R|u8<br>Версия ПО загрузчика|u8<br>Год сборки ПО загрузчика|
|0x0007<br>|R|u8<br>Месяц сборки ПО загрузчика|u8<br>День сборки ПО загрузчика|
|0x0008|R|_bitfield_ <br>бит 7: -режим работы устройства <br> 0 –загрузчик <br> 1 –основное ПО <br>биты 0..6: –ошибки загрузчика <br> 0 –ОК <br> 1 –Ошибка теста основного ПО <br> 2 –Нету основного ПО <br> 3 –Ошибка проверки контрольной <br>суммы основного ПО|u8<br>Адрес устройства на шине Modbus|


7.4.4 Регистры статуса устройства (Input registers):







|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0000<br>0x0009|R|«Jun 18 2023 15:00:00»<br>Версия основного ПО|«Jun 18 2023 15:00:00»<br>Версия основного ПО|
|0x0010<br>0x0011|R|u32<br>Время работы устройства в секундах|u32<br>Время работы устройства в секундах|
|0x0012<br>|R|_bitfield_ <br>бит 0: -режим работы устройства <br> 0 –загрузчик <br> 1 –основное ПО <br>бит 1: -поиск устройства <br> 0 –выключен <br> 1 –включен <br>бит 2: -состояние радио модуля <br> 0 –радио модуль отключено <br> 1 –радио модуль включен <br>|u8<br>Код последней загрузки/перезагрузки|



[20 ]




|0x0013<br>0x0014|R|u32<br>Маска обновлений состояний радиоустройств|
|---|---|---|
|0x0015<br>0x0016|R|u32<br>Маска обновлений данных радиоустройств|
|0x0017<br>0x0018|R|u32<br>Маска наличия радиоустройств в ячейке|
|0x0013<br>0x0014|R|u32<br>Маска с данными дискретных датчиков|


7.4.5 Регистры команд устройства (Holding Registers):






|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x8000|R/W|u16<br>Идентификатор команды:<br> 0 –Нет команды (состояние после запуска) <br> 2 –Команда добавления устройства <br> 3 –Добавление устройства по 12-байтному серийный номер <br> 4 -Добавление устройства по 6-байтному серийный номер <br> 5 –Удалить устройство <br> 6 –Контроль устройства <br>|u16<br>Идентификатор команды:<br> 0 –Нет команды (состояние после запуска) <br> 2 –Команда добавления устройства <br> 3 –Добавление устройства по 12-байтному серийный номер <br> 4 -Добавление устройства по 6-байтному серийный номер <br> 5 –Удалить устройство <br> 6 –Контроль устройства <br>|
|0x8001|R/W|i16<br>Статус команды: <br>-5 –время вышло <br>-4 –радио устройство отключено <br>-3 –отмена команды из-за конфигурации <br>-2 –значение аргумента команды не правильное <br>-1 –Идентификатор команды не поддерживается <br> 0 –ОК <br> 1 –Нет команды состояние после запуска <br> 2 –Обработка команды|i16<br>Статус команды: <br>-5 –время вышло <br>-4 –радио устройство отключено <br>-3 –отмена команды из-за конфигурации <br>-2 –значение аргумента команды не правильное <br>-1 –Идентификатор команды не поддерживается <br> 0 –ОК <br> 1 –Нет команды состояние после запуска <br> 2 –Обработка команды|
|0x8002<br>… <br>0x800F<br>|R/W|u16<br>Значение аргумента команды|u16<br>Значение аргумента команды|



Идентификаторы команд :
















|Команда|Название команды|Значение аргумента команды|Col4|Col5|
|---|---|---|---|---|
|2|Начало добавления <br>устройства|_Bitfield_<br>бит 0:  -режим добавления устройства <br>  0 –остановить добавление <br>  1 –разрешить добавление|_Bitfield_<br>бит 0:  -режим добавления устройства <br>  0 –остановить добавление <br>  1 –разрешить добавление|_Bitfield_<br>бит 0:  -режим добавления устройства <br>  0 –остановить добавление <br>  1 –разрешить добавление|
|3|Добавление <br>устройства по 12-<br>байтному серийный <br>номер|**Регистр **|**MSB**|**LSB**|
|3|Добавление <br>устройства по 12-<br>байтному серийный <br>номер|0x8002<br>… <br>0x8007|12x u8<br>12-байтный серийный номер устройства|12x u8<br>12-байтный серийный номер устройства|
|3|Добавление <br>устройства по 12-<br>байтному серийный <br>номер|0x8008<br>|u8<br>Номер канала устройства|u8<br>Тип устройства: <br>  0x54 -Датчик протечки <br>  0x1A –Термостат|



21
10.02.2025


|Col1|Col2|Col3|Col4|0x22 – Датчик температуры|
|---|---|---|---|---|
|||0x8009||_Bitfield_<br>бит 0:  -контроль устройства <br>  0 –нет контроля <br>  1 –контролируется|
|<br> <br> <br>4|<br> <br> <br>Добавление <br>устройства по 3-<br>байтному серийный <br>номер|**Регистр **|**MSB**|**LSB**|
|<br> <br> <br>4|<br> <br> <br>Добавление <br>устройства по 3-<br>байтному серийный <br>номер|0x8002<br>0x8003|4x u8<br>3-байтный серийный номер устройства|4x u8<br>3-байтный серийный номер устройства|
|<br> <br> <br>4|<br> <br> <br>Добавление <br>устройства по 3-<br>байтному серийный <br>номер|0x8004<br>|u8<br>Номер канала устройства|u8<br>Тип устройства: <br>  0x54 -Датчик протечки <br>  0x1A –Термостат <br>  0x22 –Датчик температуры|
|<br> <br> <br>4|<br> <br> <br>Добавление <br>устройства по 3-<br>байтному серийный <br>номер|0x8005||_Bitfield_<br>бит 0:  -контроль устройства <br>  0 –нет контроля <br>  1 –контролируется|
|5|Удалить устройство|0x8002|u8<br>Номер удаляемого канала устройства|u8<br>Номер удаляемого канала устройства|
|6|Установка бита <br>контроля устройства|0x8002||_Bitfield_<br>бит 8: -контроль устройства <br>  0 –сброс контроля <br>  1 –установить контроль <br>бит 0..7:<br>    -Номер канала устройства|



7.4.6 Общие регистры радиоустройств (Holding Registers), где N- номер устройства

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x1N00<br>0x1N01|R|3x u8<br>Уникальный 3-байтный серийный номер радиоустройства|3x u8<br>Уникальный 3-байтный серийный номер радиоустройства|
|0x1N02<br>0x1N07|R|12x u8<br>Уникальный 12-байтный серийный номер радиоустройства|12x u8<br>Уникальный 12-байтный серийный номер радиоустройства|
|0x1N08|R||_bitfield_ <br>бит 0: -Яцейка Nхранение устройства <br> 0 –не сохранено <br> 1 –сохранено <br>бит 1: -Связь с Nустройством <br> 0 –нет связи <br> 1 –ест связь <br>бит 2: -назначения адаптера мастером <br>для Nустройства <br> 0 –не назначен <br> 1 –назначен <br>бит 3: -тест на Nустройстве <br> 0 –выключен <br> 1 –включен <br>бит 4: -устройство N “украдено” <br> 0 –устройство в этой сети|



[22 ]


|Col1|Col2|Col3|1 – устройство было добавлено в другую<br>сеть<br>бит 5: - постоянное состояние приемника<br>на N устройстве<br>0 – не включен постоянно<br>1 – включен постоянно|
|---|---|---|---|
|0x1N09|R|u8<br>Значение мощности сигнала, <br>принимаемое от мастера <br>-157+u8|u8<br>Значение мощности сигнала, принимаемое <br>от устройства <br>-157+u8|
|0x1N0A|R||i8<br>Состояние батареи в беспроводном <br>датчике: <br>  -2 –батарея не установлена <br>  -1 –состояние неизвестно <br>   0 –низкий заряд батареи <br>   1..3 –уровни заряда батареи|
|0x1N0B|R|u8<br> Тип устройства: <br>  0x54 -Датчик протечки <br>  0x1A –Термостат <br>  0x22 –Датчик температуры|u8<br>Число канаком в многоканальном <br>устройстве|
|0x1N0C|R|<br>u8<br> <br>Версия протокола Lora<br>|u8<br>Версия прошивки Nустройства|



7.4.6.1 Карта регистров для термостата, где N- номер устройства

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x1N10|R/W|i16<br>Значение температура с датчика термостата|i16<br>Значение температура с датчика термостата|
|0x1N11|R/W|_bitfield_ <br>бит 0: -статус горелки в термостате <br> 0 –отключен <br> 1 -включен|_bitfield_ <br>бит 0: -статус горелки в термостате <br> 0 –отключен <br> 1 -включен|
|0x1N12|R/W|i16<br>Значение температуры установленной в системе|i16<br>Значение температуры установленной в системе|
|0x1N12|R/W|i16<br>Значение температуры установленной в термостате|i16<br>Значение температуры установленной в термостате|



7.4.6.2 Карта регистров для датчиков, где N- номер устройства, M- номер канала
устройства +0x10

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|**Датчик температуры **|**Датчик температуры **|**Датчик температуры **|**Датчик температуры **|
|0x1NM0|R/W|i16<br>Значение температуры с датчика|i16<br>Значение температуры с датчика|
|**Датчик протечки **|**Датчик протечки **|**Датчик протечки **|**Датчик протечки **|



23
10.02.2025


[24 ]


8. БЛОК УПАРВЛЕНИЯ СМЕСИТЕЛЬНЫМИ
КОНТУРАМИ RS-485 (Modbus)


8.1. Что умеет блок управления смесительными контурами ?


- поддерживать заданную температуру в смесительном контуре, оснащенным
моторизированным электроприводом трехходового крана ;

- произвольно задавать температуру поддержания в смесительном контуре ;

- ручной и автоматический режимы работы ;

- установка относительного положения электропривода трехходового крана ;

- установка абсолютного положения ( установка необходимой степени открытия с
применением предварительного полного закрытия )


8.2. Структуры блока управления смесительными контурами


Для доступа к регистрам адаптеров используются функции :

Read Holding Registers (0x03) для чтения регистров,

Read Input Registers (0x04) для чтения регистров

Write Holding Registers (0x10) для записи в регистры .


Регистры для конфигурации устройства (Holding Registers), где адрес N – номер канала
регулятора (1, 2, 3, 4)

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0N00<br>0x0N01|R/W|float<br>коэффициент усиления пропорциональной составляющей ПИД регулятор подачи <br>от -3.4028235E+38до 3.4028235E+38|float<br>коэффициент усиления пропорциональной составляющей ПИД регулятор подачи <br>от -3.4028235E+38до 3.4028235E+38|
|0x0N02|R/W|u16<br>коэффициент усиления интегральной составляющей ПИД регулятор подачи <br>от 0 до 65535|u16<br>коэффициент усиления интегральной составляющей ПИД регулятор подачи <br>от 0 до 65535|
|0x0N03<br>|R/W|u16<br>дифференциальная постоянная ПИД-регулятора подачи <br>коэффициент усиления дифференциальный составляющей ПИД регулятор подачи <br>от 0 до 65535|u16<br>дифференциальная постоянная ПИД-регулятора подачи <br>коэффициент усиления дифференциальный составляющей ПИД регулятор подачи <br>от 0 до 65535|
|0x0N04<br>0x0N05|R/W|u32<br>период ШИМ в миллисекундах|u32<br>период ШИМ в миллисекундах|
|0x0N06|R/W|u8<br>максимальная модуляция ШИМ, %|u8<br>абсолютное значение степени открытия клапана <br>при отказе датчика температуры в процентах|
|0x0N07|R/W|u16<br>время полного открытия в секундах|u16<br>время полного открытия в секундах|
|0x0N08|R/W|i16<br>установка в десятых градуса Цельсия|i16<br>установка в десятых градуса Цельсия|



25
10.02.2025


|0x0N09|R/W|u8<br>биты:<br>0:<br>0 - ручной режим<br>1 - автоматический<br>1:<br>0 - регулирование только по подаче<br>1 - регулирование по подаче и<br>обратке(регистр 0x0N08 задает<br>температуру обратки)|u8<br>0 - привод смесительного крана<br>1 - нормально открытый клапан<br>2 - нормально закрытый клапан|
|---|---|---|---|
|0x0N0A|R/W|i16<br>минимальная допустимая уставка|i16<br>минимальная допустимая уставка|
|0x0N0B|R/W|i16<br>максимальная допустимая уставка|i16<br>максимальная допустимая уставка|
|||||
|0x8N00|R/W|u16<br>0 –нет команды –сост. после запуска <br>2 –команда относительного управления (аргументы: значение -100..+100 %)<br>3 –команда абсолютного управления (аргументы: значение 0..100 %)<br>|u16<br>0 –нет команды –сост. после запуска <br>2 –команда относительного управления (аргументы: значение -100..+100 %)<br>3 –команда абсолютного управления (аргументы: значение 0..100 %)<br>|
|0x8N01|R/W|u16<br>0 – ok<br>1 –нет команды –сост. после запуска <br>2 –команда выполняется|u16<br>0 – ok<br>1 –нет команды –сост. после запуска <br>2 –команда выполняется|
|0x8N02|R/W|u16<br>значение аргументов команды|u16<br>значение аргументов команды|
|||||


Регистры устройства (Input Registers), где адрес N – номер канала регулятора (1, 2, 3, 4)

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0N00<br>|R|u8<br>режим работы <br>0 –инициализация <br>1 –ручной режим <br>2 –автоматический режим <br>3 –аварийный режим <br>4 -режим защиты (температура за <br>пределами регулирования)||
|0x0N01<br>0x0N02|R|u32<br>время со старта или перезагрузки контроллера в мс|u32<br>время со старта или перезагрузки контроллера в мс|
|0x0N03|R|i16<br>показания датчика температуры подачи|i16<br>показания датчика температуры подачи|
|0x0N04<br>|R|i16<br>код ошибки <br>-1нет термодатчика <br>-2неисправность термодатчика <br>-3режим защиты, температура выше допустимой|i16<br>код ошибки <br>-1нет термодатчика <br>-2неисправность термодатчика <br>-3режим защиты, температура выше допустимой|



[26 ]


9. БЛОК ИЗМЕРИТЕЛЬНЫЙ 8 КАНАЛОВ


9.1. Структуры блока управления измерительным блоком на 8 каналов


Для доступа к регистрам адаптеров используются функции :

Read Holding Registers (0x03) для чтения регистров,

Read Input Registers (0x04) для чтения регистров

Write Holding Registers (0x10) для записи в регистры .

Read Device Address Serial Number (0x4b) для чтения адреса устройства по его серийному

номеру

Write Device Address Serial Number (0x4 с ) для записи адреса устройства по его серийному

номеру


Чтение адреса устройства по его серийному номеру (Read Device Address Serial Number):


Запрос от мастера :

|00h|4Bh|00h|00h|00h|00h|00h|00h|00h|00h|00h|00h|4Fh|4Ah|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|CRC<br>старш.|CRC<br>младш.|



Ответ от устройства :


|00h|4Bh|01h|86h|F0h|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|
||||||



Запись адреса устройства по его серийному номеру (Write Device Address Serial Number):
Запрос от мастера :

|00h|4Ch|00h|00h|00h|00h|00h|00h|00h|00h|00h|00h|01h|CCh|F3h|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|<br> <br> <br> <br> <br> <br> <br> <br> <br>Уникальный 12-байтный серийный номер устройства|Адрес <br>устр-ва|CRC<br>старш.|CRC<br>младш.|



Ответ от устройства :

|00h|4Ch|01h|84h|C0h|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



Регистры информация об устройстве (Holding Registers):

|Адрес<br>регистра|Тип<br>доступа|MSB|LSB|
|---|---|---|---|
|0x0000<br>0x0005|R|12x u8<br>Уникальный 12-байтный серийный номер устройства|12x u8<br>Уникальный 12-байтный серийный номер устройства|
|0x0006|R|u8<br>Версия ПО загрузчика|u8<br>Год сборки ПО <br>загрузчика|



27
10.02.2025


|0x0007|R|u8<br>Месяц сборки ПО загрузчика|u8<br>День сборки ПО<br>загрузчика|
|---|---|---|---|
|0x0008|R|_bitfield_ <br>**бит 7: -режим работы устройства **<br>  0 –загрузчик <br>  1 –основное ПО <br>**биты 0..6: –ошибки загрузчика **<br>  0 –ОК <br>  1 –Ошибка теста основного ПО <br>  2 –Нету основного ПО <br>  3 –Ошибка проверки контрольной суммы основного ПО <br>**биты 0..6: –ошибки основного ПО **<br>  0 –ОК <br>  1 –нет ответа от АДЦ 1<br>  2 –нет ответа от АДЦ 2<br>  3 –нет данных по шине I2C|u8<br>Адрес устройства на <br>шине Modbus|
|0x0030|R/W|u8<br>Период опроса датчика на первом канале: <br> 15..60сек(0x0F..0x3C)<br> 0 –канал не измеряет <br> 1 –значение для сухого контакта|u8<br>**Типы подключаемых **<br>**датчиков: **<br> 0x00 –датчик не <br>выбран <br>**Термопреобразователи **<br>**сопротивления: **<br> 0x0A – Pt500<br> 0x0B – 500П <br> 0x0C – Cu500<br> 0x0D – 500M<br> 0x0E – Ni500<br> 0x0F – Cu1000<br> 0x10 – 1000M<br> 0x11 – Pt1000<br> 0x12 – 1000П <br> 0x13 – Ni1000<br>**Унифицированные **<br>**сигналы: **<br> 0x30 –вход 0..20мА <br> 0x31 -вход 4..20мА <br> 0x32 -вход 0..5мА <br> 0x33 –вход 0..2500мV <br>**Сигнал активного **<br>**сопротивления **<br> 0x3А – 25…2000Ом <br>**Сухой контакт: **<br> 0x32 –сухой контакт|
|0x0031|R/W||u8<br>**Фильтр измеряемых **<br>**значений: **<br> 0x00 –Фильтр выключен <br> 0x01 –<br>Среднеарифметический <br>фильтр включен <br> 0x02 –Медианный <br>фильтр включен <br> 0x03 –Средне <br>скользящий фильтр <br>включен|
|0x0032<br>… <br>0x0040|R/W|Структура регистра такая же ка и у 0x0030-0x0031,только изменяется номер <br>канала|Структура регистра такая же ка и у 0x0030-0x0031,только изменяется номер <br>канала|



Регистры статуса устройства (Input registers):


[28 ]


|0x0000<br>0x0009|R|«Jun 18 2025 15:00:00»<br>Версия основного ПО|Col4|
|---|---|---|---|
|0x0010<br>0x0011|R|u32<br>Время работы устройства в секундах|u32<br>Время работы устройства в секундах|
|0x0012<br>|R|_bitfield_ <br>**Битовая маска каналов: **<br>биты:0-7 -установка бита означает замыкания контакта, <br>при условии, что этот контакт настроен как сухой <br>контакт.<br>||
|0x0013|R|u8<br>Напряжение внешнего источника питания 0..255 (0-25.5v)|<br>u8<br>Напряжение <br>собственного источника <br>питания 0..255 (0-<br>25.5v)|
|0x0014|R|u8<br>Аппаратная версия блока|i8<br>Температура <br>внутреннего блока|
|0x0020<br>|R|u16<br>Измеренное значение на первом канале измерительного блока <br>0x7FFF –не подключен датчик или вышли из диапазона измерений.|u16<br>Измеренное значение на первом канале измерительного блока <br>0x7FFF –не подключен датчик или вышли из диапазона измерений.|
|0x0021<br>  …<br>0x0028|R|u16<br>Структура регистра такая же ка и у 0x0020,только изменяется номер канала|u16<br>Структура регистра такая же ка и у 0x0020,только изменяется номер канала|



29
10.02.2025


10. ПРИМЕРЫ ПАКЕТОВ ДАННЫХ


Для того, чтобы произвести обмен данными с устройствами, достаточно установить на ПК
утилиту Modbus Poll: https://www.modbustools.com/modbus_poll.html, подключить к ПК
адаптер COM-RS485 ( или USB-RS485), выполнить настройки соединения с адаптером, а
затем произвести чтение или запись требуемых регистров устройства .

Порядок действий таков :

1. Откройте окно настроек соединения (Connection -> Connect), выберите
последовательный порт, к которому подключен адаптер RS-485. Убедитесь, что
настройки порта соответствуют скорости 19200 бит / с, 8 бит данных, без контроля
четности, 1 стоп   - бит, а режим обмена данными   - «RTU».


2. Откройте окно отправки произвольных данных (Functions -> Test Center), введите
данные для отправки устройству : адрес, код функции, требуемые данные, контрольную
сумму . При активации параметров «Add check» и «CRC» контрольную сумму вводить не
нужно, программа рассчитает ее самостоятельно . Нажмите «Send» для отправки
данных и наблюдайте ответ устройства . Таким образом можно настроить адрес
устройства, использовав функцию 0x47.


[30 ]


Все данные примеров ниже представлены в шестнадцатеричном виде .

1. Программирование устройства с адресом 01h нового адреса 05h.

Запрос от мастера - чтение имеющегося адреса ( необязательный запрос ):

|00h|46h|80h|42h|
|---|---|---|---|
|адрес|функция|CRCстарш.|CRCмладш.|



Ответ от устройства :

|00h|46h|01h|82|60|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



Запрос от мастера - запись нового адреса в устройство :

|01h|47h|05h|D3|F3|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



Ответ от устройства :

|05h|47h|05h|92|32|
|---|---|---|---|---|
|адрес|функция|Адрес устр-ва|CRCстарш.|CRCмладш.|



Чтение типа и адреса ведется одним запросом .

2. Чтение типа и ID устройства с адресом 01h:

Запрос от мастера :



|01h|03h|00h|00h|00h|04h|44h|09h|
|---|---|---|---|---|---|---|---|
|Адрес|функция|Адрес рег. <br>ст.|Адрес рег. мл.|Кол-во. рег. <br>ст.|Кол-<br>во. <br>рег. <br>мл.|CRC<br>младш.|CRC<br>старш.|


Ответ от устройства :










|01h 0|3h|08h|00h|A7h|E1h|A4h|00h|01h|22h|01h|ADh|D5h|
|---|---|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функ<br>ция|Кол-во <br>байт|RSVD|ID[0]|D[1]|D[2]|RSVD|Адресс <br>устр-<br>ва.|Тип <br>устр-<br>ва.|Кол-во. <br>каналов|CRC<br>младш.|CRC<br>старш.|



3. Чтение данных датчика температуры ( влажности ) с адресом 07h:

Запрос от мастера :

|07h|04h|00h|20h|00h|01h|30H|66H|
|---|---|---|---|---|---|---|---|
|адрес|функция|Адрес рег. <br>ст.|Адрес рег. <br>мл.|Кол-во. рег. <br>ст.|Кол-во. <br>рег. мл.|CRCмладш.|CRCстарш.|



Ответ от устройства :

|07h|04h|02h|01h|30h|30h|B4h|
|---|---|---|---|---|---|---|
|адрес|функция|Кол-во байт|Темп. ст.|Темп. мл.|CRCмладш.|CRCстарш.|



Полученные данные температуры (130h) в десятичном виде выглядит как 304, т . е . 30,4 С
для датчика влажности и 30,4% для датчика влажности .


31
10.02.2025


4. Включение второго канала и выключение остальных реле с адресом 18h

Запрос от мастера :

|18h|10h|00h|10h|00h|01h|02h|02h|00h|02h|30h|
|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|Адрес <br>рег. ст.|Адрес рег. <br>мл.|Кол-во. <br>рег. ст.|Кол-во. <br>рег. мл.|Кол-во <br>байт|Рег ст.|Рег мл.|CRCмладш.|CRCстарш.|



Ответ от устройства :

|18h|10h|00h|10h|00h|01h|02h|05h|
|---|---|---|---|---|---|---|---|
|адрес|функция|Адрес рег. ст.|Адрес рег. мл.|Кол-во. рег. <br>ст.|Кол-во. рег. <br>мл.|CRC<br>младш.|CRCстарш.|



В регистр с адресом 0 пишется значение 0200h. Старшая часть регистра отражает значение
первых 8 выходов . Младшая - выходов с 9 по 16.

5. Включение второго канала блока реле на 100 секунд

Запрос от мастера :










|18h|10h|00h|21h|00h|01h|02h|80h|C8h|67h|27h|
|---|---|---|---|---|---|---|---|---|---|---|
|адрес|функция|Адрес <br>рег. <br>ст.|Адрес <br>рег. <br>мл.|Кол-во. <br>рег. <br>ст.|Кол-во. <br>рег. мл.|Кол-во <br>байт|Рег ст.|Рег мл.|CRCмладш.|CRCстарш.|



Ответ от устройства :








|18h|10h|00h|21h|00h|01h|53h|СAh|
|---|---|---|---|---|---|---|---|
|адрес|функция|Адрес <br>рег. <br>ст.|Адрес рег. <br>мл.|Кол-во. <br>рег. ст.|Кол-во. <br>рег. <br>мл.|CRC<br>младш.|CRCстарш.|



В регистр с адресом 0 пишется значение 80 С 8h. Старший бит числа (80h) — включение
реле . С 8h = 200 – время включения, равное 100 С ( в интервалах по 0,5 с ).


[32 ]


